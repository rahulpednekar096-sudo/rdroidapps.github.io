<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Word (DOCX) ‚Üí PDF ‚Äî RDroid Apps</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="../../css/style.css">

  <!-- docx parser -->
  <script src="https://cdn.jsdelivr.net/npm/docx-preview@1.4.0/dist/docx-preview.min.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


</head>

<body>
  <!-- RDroidApps Header -->
  <header>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <div class="logo">
      <img src="../../assets/my_brand_icon.png" alt="RDroid" />
      <div>RDroid <span>Apps</span></div>
    </div>
    <div class="nav-links">
      <a href="../../index.html" class="active">Home</a>
      <a href="../../apps.html">Apps</a>
      <a href="../../about.html">About</a>
      <a href="../../contact.html">Contact</a>
      <a href="../../windows-tools.html">Windows Tools</a>
    </div>
    <a href="../../auth/login.html" class="login-btn">üîë Login</a>
  </header>

  <!-- ===== DRAWER (UNCHANGED) ===== -->
  <nav id="drawer">
    <a href="../../index.html">üè† Home</a>
    <a href="../../apps.html">üì± Apps</a>
    <a href="../../favorites.html">‚≠ê Favorites</a>
    <a href="../../profile.html">üë§ Profile</a>
    <a href="../../about.html">‚ÑπÔ∏è About</a>
    <a href="../../contact.html">‚úâÔ∏è Contact</a>
    <a href="../../privacy-policy.html">üîí Privacy Policy</a>
  </nav>
  <section class="section">

    <h1>Word (DOCX) ‚Üí PDF</h1>
    <p class="lead">Upload a Word DOCX file and convert it to PDF. Fully client-side, safe & fast.</p>

    <div class="drop" id="dropArea">
      Drop DOCX here or <button class="btn" id="pickBtn">Choose file</button>
      <input type="file" id="fileInput" accept=".docx" style="display:none">
    </div>

    <div class="controls" style="margin-top:10px">
      <label>Page size</label>
      <select id="pageSize">
        <option value="A4">A4</option>
        <option value="Letter">Letter</option>
      </select>

      <label>Orientation</label>
      <select id="orientation">
        <option value="p">Portrait</option>
        <option value="l">Landscape</option>
      </select>

      <label>Margins (mm)</label>
      <input type="number" id="margin" value="10">
    </div>

    <button class="btn-primary" id="convertBtn" style="margin-top:12px">Convert to PDF</button>

    <div class="progress" id="progressWrap">
      <div class="bar" id="progressBar"></div>
    </div>

    <h3 style="margin-top:20px">Preview</h3>
    <div id="preview" class="preview"></div>

    <pre id="log" class="log">Ready.</pre>

    <div id="download"></div>

  </section>
  <footer>¬© 2025 RDroid Apps ‚Äî PDF Tools</footer>
  <script>
    // Drawer toggle
    function toggleMenu() {
      document.getElementById("drawer").classList.toggle("open");
    }
    const pickBtn = document.getElementById("pickBtn");
    const fileInput = document.getElementById("fileInput");
    const dropArea = document.getElementById("dropArea");
    const preview = document.getElementById("preview");
    const logEl = document.getElementById("log");
    const progressWrap = document.getElementById("progressWrap");
    const progressBar = document.getElementById("progressBar");
    const download = document.getElementById("download");
    let currentFile = null;

    function log(msg) { logEl.textContent += "\n" + msg; logEl.scrollTop = logEl.scrollHeight; }
    function clear() { preview.innerHTML = ""; download.innerHTML = ""; logEl.textContent = "Ready."; }
    function setProgress(p) { progressWrap.style.display = p >= 0 ? "block" : "none"; progressBar.style.width = (p * 100) + "%"; }

    pickBtn.onclick = () => fileInput.click();
    fileInput.onchange = e => loadDocx(e.target.files[0]);

    dropArea.ondragover = e => { e.preventDefault(); dropArea.style.borderColor = "#0aa37f"; }
    dropArea.ondragleave = () => dropArea.style.borderColor = "#222";
    dropArea.ondrop = e => {
      e.preventDefault(); dropArea.style.borderColor = "#222";
      loadDocx(e.dataTransfer.files[0]);
    };

    async function loadDocx(file) {
      if (!file) return;
      clear();
      log("Loading DOCX...");

      currentFile = file;
      preview.innerHTML = "Rendering preview...";
      docx.renderAsync(file, preview);
      log("Preview ready.");
    }

    document.getElementById("convertBtn").onclick = async () => {
      if (!currentFile) { alert("Select a DOCX file first"); return; }

      log("Converting to PDF...");
      setProgress(0);

      const text = preview.innerText;
      const lines = text.split("\n");

      const { jsPDF } = window.jspdf;
      const size = document.getElementById("pageSize").value === "A4" ? "a4" : "letter";
      const orientation = document.getElementById("orientation").value === "p" ? "portrait" : "landscape";
      const margin = parseFloat(document.getElementById("margin").value) || 10;
      const pdf = new jsPDF({ unit: "mm", format: size, orientation });
      let y = margin;

      pdf.setFontSize(12);

      for (let i = 0; i < lines.length; i++) {
        const wrapped = pdf.splitTextToSize(lines[i], pdf.internal.pageSize.getWidth() - margin * 2);
        wrapped.forEach(line => {
          if (y > pdf.internal.pageSize.getHeight() - margin) {
            pdf.addPage(); y = margin;
          }
          pdf.text(margin, y, line);
          y += 6;
        });
        setProgress((i + 1) / lines.length);
        await new Promise(r => setTimeout(r, 5));
      }

      log("Building PDF...");
      const blob = pdf.output("blob");
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "converted.pdf";
      a.textContent = "Download PDF";
      a.className = "btn-primary";
      download.appendChild(a);

      log("Done.");
      setProgress(-1);
    };
  </script>

</body>

</html>
