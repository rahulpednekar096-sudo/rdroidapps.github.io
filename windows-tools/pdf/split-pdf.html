<!DOCTYPE html>
<html lang="mr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Split PDF ‚Äî RDroid Apps</title>
  <link rel="stylesheet" href="../../css/style.css">

  <!-- pdf.js for preview -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <!-- pdf-lib for manipulation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <!-- jszip + filesaver -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <style>
    :root {
      --card: #131619;
      --muted: #9fbfb0;
      --accent: #0aa37f
    }

    body {
      margin-top: 100px;
    }

    .menu-btn {
      background: transparent;
      border: none;
      color: var(--accent);
      font-size: 20px;
      cursor: pointer;
    }

    .container {
      max-width: 980px;
      margin: 40px auto;
      padding: 20px;
      background: var(--card);
      border-radius: 12px
    }

    h1 {
      margin: 0 0 8px
    }

    p.lead {
      color: var(--muted)
    }

    .drop {
      border: 2px dashed #202426;
      padding: 18px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      color: var(--muted)
    }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px
    }

    .control {
      background: #0f1315;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #222;
      min-width: 220px
    }

    .btn {
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer
    }

    .btn-primary {
      background: #0aa37f;
      color: #fff;
      border: none
    }

    .thumb {
      width: 120px;
      padding: 8px;
      border-radius: 8px;
      background: #0b0c0d;
      border: 1px solid #222;
      text-align: center;
      margin: 8px;
      display: inline-block
    }

    .thumb img {
      max-width: 100px;
      border-radius: 6px
    }

    .progress {
      height: 12px;
      background: #0b0c0d;
      border-radius: 8px;
      margin-top: 12px;
      display: none
    }

    .bar {
      height: 100%;
      width: 0%;
      background: var(--accent);
      transition: width .2s
    }

    .log {
      margin-top: 12px;
      background: #0b0c0d;
      padding: 12px;
      border-radius: 8px;
      color: var(--muted);
      max-height: 200px;
      overflow: auto;
      font-size: 13px
    }

    .input-range {
      width: 100%;
      padding: 6px;
      border-radius: 6px;
      background: #090b0c;
      border: 1px solid #222;
      color: #e6eef0
    }
  </style>
</head>

<body>
  <!-- RDroidApps Header -->
  <header>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <div class="logo">
      <img src="../../assets/my_brand_icon.png" alt="RDroid Logo" />
      <div>RDroid <span>Apps</span></div>
    </div>
    <a href="/auth/login.html" class="login-btn">üîë Login</a>
  </header>

  <!-- Drawer Navigation -->
  <nav id="drawer">
    <a href="../../index.html">üè† Home</a>
    <a href="../../apps.html">üì± Apps</a>
    <a href="../../favorites.html">‚≠ê Favorites</a>
    <a href="../../profile.html">üë§ Profile</a>
    <a href="../../about.html">‚ÑπÔ∏è About</a>
    <a href="../../contact.html">‚úâÔ∏è Contact</a>
    <a href="../../privacy-policy.html">üîí Privacy Policy</a>
  </nav>
  <div class="container">
    <h1>Split PDF</h1>
    <p class="lead">Split PDF by ranges, every N pages, or extract selected pages. Outputs separate PDFs or a ZIP.</p>

    <div class="drop" id="dropArea">Drop PDF here or <button class="btn" id="pickBtn">Choose file</button>
      <input type="file" id="fileInput" accept="application/pdf" style="display:none">
    </div>

    <div class="controls">
      <div class="control">
        <label>Mode</label>
        <select id="modeSelect">
          <option value="ranges">Split by ranges (1-3,4-6)</option>
          <option value="everyN">Split every N pages</option>
          <option value="extract">Extract selected pages</option>
        </select>

        <div id="rangesUI" style="margin-top:8px;">
          <label>Ranges (comma separated, e.g. 1-3,5,7-9)</label>
          <input type="text" id="rangesInput" placeholder="1-3,5,7-9"
            style="width:100%;padding:8px;margin-top:6px;background:#090b0c;border:1px solid #222;color:#e6eef0;border-radius:6px">
        </div>

        <div id="everyNUI" style="display:none;margin-top:8px;">
          <label>Every N pages</label>
          <input type="number" id="everyN" value="2" min="1"
            style="width:100%;padding:8px;background:#090b0c;border:1px solid #222;color:#e6eef0;border-radius:6px">
        </div>
      </div>

      <div class="control">
        <label>Output</label>
        <select id="outType">
          <option value="zip" selected>ZIP (multiple files)</option>
          <option value="files">Individual downloads</option>
        </select>
        <label style="margin-top:8px">Base name</label>
        <input type="text" id="outBase" value="split"
          style="width:100%;padding:8px;background:#090b0c;border:1px solid #222;color:#e6eef0;border-radius:6px">
      </div>

      <div class="control">
        <label>Preview / Select Pages</label>
        <div id="thumbsWrap"></div>
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <button class="btn-primary" id="splitBtn">Split</button>
      <button class="btn" id="clearBtn">Clear</button>
      <div style="margin-left:auto;color:#9fbfb0" id="pageInfo"></div>
    </div>

    <div class="progress" id="progressWrap">
      <div class="bar" id="progressBar"></div>
    </div>
    <pre class="log" id="log">Ready.</pre>

    <div id="downloadArea" style="margin-top:12px"></div>
  </div>
  <footer>¬© 2025 RDroid Apps ‚Äî PDF Tools</footer>
  <script>
    // Drawer toggle
    function toggleMenu() {
      document.getElementById("drawer").classList.toggle("open");
    }
    const pickBtn = document.getElementById('pickBtn'), fileInput = document.getElementById('fileInput'), dropArea = document.getElementById('dropArea');
    const modeSelect = document.getElementById('modeSelect'), rangesInput = document.getElementById('rangesInput'), everyNUI = document.getElementById('everyNUI');
    const everyN = document.getElementById('everyN'), rangesUI = document.getElementById('rangesUI');
    const outType = document.getElementById('outType'), outBase = document.getElementById('outBase');
    const splitBtn = document.getElementById('splitBtn'), clearBtn = document.getElementById('clearBtn');
    const thumbsWrap = document.getElementById('thumbsWrap'), logEl = document.getElementById('log'), progressWrap = document.getElementById('progressWrap'), progressBar = document.getElementById('progressBar');
    const pageInfo = document.getElementById('pageInfo'), downloadArea = document.getElementById('downloadArea');
    let pdfBytes = null, pdfDocJS = null, pageCount = 0, pages = []; // pages: {pageNum, thumb, selected}

    function log(msg) { logEl.textContent += '\\n' + msg; logEl.scrollTop = logEl.scrollHeight; }
    function setProgress(p) { progressWrap.style.display = p >= 0 ? 'block' : 'none'; progressBar.style.width = ((p || 0) * 100).toFixed(1) + '%'; }

    modeSelect.addEventListener('change', () => {
      const m = modeSelect.value;
      rangesUI.style.display = m === 'ranges' ? 'block' : 'none';
      everyNUI.style.display = m === 'everyN' ? 'block' : 'none';
    });

    pickBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => loadFile(e.target.files[0]));

    dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.style.borderColor = '#0aa37f'; });
    dropArea.addEventListener('dragleave', () => dropArea.style.borderColor = '#202426');
    dropArea.addEventListener('drop', e => { e.preventDefault(); dropArea.style.borderColor = '#202426'; if (e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]); });

    async function loadFile(file) {
      if (!file) return;
      if (file.type !== 'application/pdf') { alert('Please select a PDF'); return; }
      log('Loading ' + file.name);
      pdfBytes = await file.arrayBuffer();
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
      pdfDocJS = await pdfjsLib.getDocument({ data: pdfBytes }).promise;
      pageCount = pdfDocJS.numPages;
      pages = [];
      thumbsWrap.innerHTML = '';
      for (let i = 1; i <= pageCount; i++) {
        const page = await pdfDocJS.getPage(i);
        const vp = page.getViewport({ scale: 0.2 });
        const canvas = document.createElement('canvas'); canvas.width = vp.width; canvas.height = vp.height;
        await page.render({ canvasContext: canvas.getContext('2d'), viewport: vp }).promise;
        const dataURL = canvas.toDataURL('image/png');
        pages.push({ pageNum: i, thumb: dataURL, selected: true });
        renderThumbnails();
        await briefYield(10);
      }
      pageInfo.textContent = pageCount + ' pages';
      log('PDF loaded with ' + pageCount + ' pages');
    }

    function renderThumbnails() {
      thumbsWrap.innerHTML = '';
      pages.forEach((p, idx) => {
        const div = document.createElement('div'); div.className = 'thumb';
        div.innerHTML = `<img src="${p.thumb}"><div style="color:#9fbfb0">Page ${p.pageNum}</div>
        <div style="margin-top:6px"><label><input type="checkbox" data-idx="${idx}" ${p.selected ? 'checked' : ''}> Select</label></div>`;
        thumbsWrap.appendChild(div);
      });
      thumbsWrap.querySelectorAll('input[type=checkbox]').forEach(cb => {
        cb.addEventListener('change', e => { pages[e.target.dataset.idx].selected = e.target.checked; });
      });
    }

    splitBtn.addEventListener('click', async () => {
      if (!pdfBytes) { alert('Load a PDF first'); return; }
      setProgress(0); log('Starting split...');
      const mode = modeSelect.value;
      let tasks = [];
      if (mode === 'ranges') {
        const raw = rangesInput.value.trim();
        if (!raw) { alert('Enter ranges'); setProgress(-1); return; }
        tasks = parseRanges(raw);
        if (!tasks.length) { alert('No valid ranges parsed'); setProgress(-1); return; }
      } else if (mode === 'everyN') {
        const n = parseInt(everyN.value) || 1;
        for (let i = 1; i <= pageCount; i += n) {
          const end = Math.min(i + n - 1, pageCount);
          tasks.push({ from: i, to: end });
        }
      } else {
        // extract selected pages into single PDF
        const sel = pages.filter(p => p.selected).map(p => p.pageNum);
        if (!sel.length) { alert('Select pages to extract'); setProgress(-1); return; }
        tasks = sel.map(pn => ({ from: pn, to: pn }));
      }

      log('Planned ' + tasks.length + ' output files.');
      const zip = new JSZip();
      const outFiles = [];

      const srcPdf = await PDFLib.PDFDocument.load(pdfBytes);
      for (let t = 0; t < tasks.length; t++) {
        const { from, to } = tasks[t];
        log('Creating PDF for pages ' + from + ' - ' + to);
        // create new doc and copy pages
        const newPdf = await PDFLib.PDFDocument.create();
        for (let p = from; p <= to; p++) {
          const [copiedPage] = await newPdf.copyPages(srcPdf, [p - 1]);
          newPdf.addPage(copiedPage);
        }
        const outBytes = await newPdf.save();
        const fname = `${outBase.value || 'split'}_${from}-${to}.pdf`;
        if (outType.value === 'zip') zip.file(fname, outBytes);
        else {
          const blob = new Blob([outBytes], { type: 'application/pdf' });
          const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = fname; a.textContent = 'Download ' + fname; a.className = 'btn'; a.style.display = 'block';
          downloadArea.appendChild(a);
        }
        setProgress((t + 1) / tasks.length);
        await briefYield(40);
      }

      if (outType.value === 'zip') {
        const blob = await zip.generateAsync({ type: 'blob' });
        saveAs(blob, (outBase.value || 'split') + '.zip');
        log('ZIP generated and downloaded.');
      } else {
        log('Files generated for direct download.');
      }

      setProgress(-1);
    });

    function parseRanges(text) {
      const parts = text.split(',').map(s => s.trim()).filter(Boolean);
      const out = [];
      for (const p of parts) {
        if (p.includes('-')) {
          const [a, b] = p.split('-').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
          if (a && b && a <= b && a >= 1 && b <= pageCount) out.push({ from: a, to: b });
        } else {
          const n = parseInt(p);
          if (n && n >= 1 && n <= pageCount) out.push({ from: n, to: n });
        }
      }
      return out;
    }

    clearBtn.addEventListener('click', () => { pdfBytes = null; pdfDocJS = null; pageCount = 0; pages = []; thumbsWrap.innerHTML = ''; downloadArea.innerHTML = ''; document.getElementById('log').textContent = 'Ready.'; setProgress(-1); pageInfo.textContent = ''; });

    function briefYield(ms = 10) { return new Promise(r => setTimeout(r, ms)); }
  </script>
</body>

</html>
