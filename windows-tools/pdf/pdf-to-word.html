<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>PDF ‚Üí Word (DOCX) ‚Äî RDroid Apps</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="../../css/style.css">

  <!-- pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <!-- docx library -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.3.2/build/index.js"></script>

  <!-- OCR (optional) -->
  <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>


</head>

<body>
  <!-- RDroidApps Header -->
  <header>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <div class="logo">
      <img src="../../assets/my_brand_icon.png" alt="RDroid" />
      <div>RDroid <span>Apps</span></div>
    </div>
    <div class="nav-links">
      <a href="../../index.html" class="active">Home</a>
      <a href="../../apps.html">Apps</a>
      <a href="../../about.html">About</a>
      <a href="../../contact.html">Contact</a>
      <a href="../../windows-tools.html">Windows Tools</a>
    </div>
    <a href="../../auth/login.html" class="login-btn">üîë Login</a>
  </header>

  <!-- ===== DRAWER (UNCHANGED) ===== -->
  <nav id="drawer">
    <a href="../../index.html">üè† Home</a>
    <a href="../../apps.html">üì± Apps</a>
    <a href="../../favorites.html">‚≠ê Favorites</a>
    <a href="../../profile.html">üë§ Profile</a>
    <a href="../../about.html">‚ÑπÔ∏è About</a>
    <a href="../../contact.html">‚úâÔ∏è Contact</a>
    <a href="../../privacy-policy.html">üîí Privacy Policy</a>
  </nav>
  <section class="section">
    <h1>PDF ‚Üí Word (DOCX)</h1>
    <p class="lead">Extract text from PDF and convert into a DOCX Word file. Supports OCR + page-wise formatting.</p>

    <div class="drop" id="dropArea">
      Drop PDF here or <button class="btn" id="pickBtn">Choose file</button>
      <input type="file" id="fileInput" accept="application/pdf" style="display:none">
    </div>

    <label><input type="checkbox" id="enableOCR"> Enable OCR (slower, better accuracy)</label>

    <div style="margin-top:10px;display:flex;gap:10px">
      <button class="btn-primary" id="convertBtn">Convert to Word</button>
      <button class="btn" id="clearBtn">Clear</button>
    </div>

    <div class="progress" id="progressWrap">
      <div class="bar" id="progressBar"></div>
    </div>

    <div id="thumbs" class="thumbs"></div>
    <pre id="log" class="log">Ready.</pre>

    <div id="download"></div>

  </section>
  <footer>¬© 2025 RDroid Apps ‚Äî PDF Tools</footer>

  <script>
    // Drawer toggle
    function toggleMenu() {
      document.getElementById("drawer").classList.toggle("open");
    }
    const pickBtn = document.getElementById("pickBtn");
    const fileInput = document.getElementById("fileInput");
    const dropArea = document.getElementById("dropArea");
    const convertBtn = document.getElementById("convertBtn");
    const logEl = document.getElementById("log");
    const thumbs = document.getElementById("thumbs");
    const progressWrap = document.getElementById("progressWrap");
    const progressBar = document.getElementById("progressBar");
    const download = document.getElementById("download");
    const enableOCR = document.getElementById("enableOCR");
    let currentPDF = null;

    /* Utility */
    function log(msg) { logEl.textContent += "\n" + msg; logEl.scrollTop = logEl.scrollHeight; }
    function clear() { logEl.textContent = "Ready."; thumbs.innerHTML = ""; download.innerHTML = ""; currentPDF = null; }
    function setProgress(p) { progressWrap.style.display = p >= 0 ? "block" : "none"; progressBar.style.width = (p * 100) + "%"; }

    /* File select */
    pickBtn.onclick = () => fileInput.click();
    fileInput.onchange = e => loadPDF(e.target.files[0]);

    dropArea.ondragover = e => { e.preventDefault(); dropArea.style.borderColor = "#0aa37f"; }
    dropArea.ondragleave = () => dropArea.style.borderColor = "#222";
    dropArea.ondrop = e => {
      e.preventDefault(); dropArea.style.borderColor = "#222";
      loadPDF(e.dataTransfer.files[0]);
    };

    /* Load PDF */
    async function loadPDF(file) {
      if (!file) return;
      clear();
      log("Loading PDF...");
      const buf = await file.arrayBuffer();
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
      currentPDF = await pdfjsLib.getDocument({ data: buf }).promise;
      log("Pages: " + currentPDF.numPages);
      await renderThumbs();
    }

    /* Render thumbnails */
    async function renderThumbs() {
      thumbs.innerHTML = "";
      for (let i = 1; i <= currentPDF.numPages; i++) {
        const page = await currentPDF.getPage(i);
        const vp = page.getViewport({ scale: 0.25 });
        const canvas = document.createElement("canvas");
        canvas.width = vp.width; canvas.height = vp.height;
        await page.render({ canvasContext: canvas.getContext("2d"), viewport: vp }).promise;
        const img = canvas.toDataURL("image/png");
        thumbs.innerHTML += `<div class="thumb"><img src="${img}"><div style="color:#9fbfb0">Page ${i}</div></div>`;
      }
    }

    /* Convert to DOCX */
    convertBtn.onclick = async () => {
      if (!currentPDF) { alert("Select a PDF first"); return; }
      log("Extracting text...");
      setProgress(0);

      const { Document, Packer, Paragraph } = docx;
      const doc = new Document({ sections: [{ properties: {}, children: [] }] });
      const children = doc.sections[0].children;
      const doOCR = enableOCR.checked;

      for (let i = 1; i <= currentPDF.numPages; i++) {
        const page = await currentPDF.getPage(i);
        let text = "";

        if (doOCR) {
          log("OCR page " + i + "...");
          const vp = page.getViewport({ scale: 1 });
          const canvas = document.createElement("canvas");
          canvas.width = vp.width; canvas.height = vp.height;
          await page.render({ canvasContext: canvas.getContext("2d"), viewport: vp }).promise;
          const ocr = await Tesseract.recognize(canvas, "eng");
          text = ocr.data.text;
        } else {
          log("Extracting text from page " + i);
          const content = await page.getTextContent();
          text = content.items.map(item => item.str).join(" ");
        }

        children.push(new Paragraph({ text: "--- Page " + i + " ---" }));
        text.split("\n").forEach(line => {
          children.push(new Paragraph({ text: line }));
        });

        setProgress(i / currentPDF.numPages);
        await new Promise(r => setTimeout(r, 20));
      }

      log("Building DOCX file...");
      const blob = await Packer.toBlob(doc);
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "converted.docx";
      a.textContent = "Download Word File";
      a.className = "btn-primary";
      download.appendChild(a);

      log("Done.");
      setProgress(-1);
    };

    document.getElementById("clearBtn").onclick = clear;
  </script>

</body>

</html>
