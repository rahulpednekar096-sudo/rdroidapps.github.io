<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Text → PDF — RDroid Apps</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- SEO Meta Tags -->
  <meta name="description"
    content="Convert plain text into a clean, formatted PDF using RDroidApps Pro. Offline, privacy-safe Text to PDF converter with page size, margins, header, footer, and font controls.">

  <meta name="keywords"
    content="Text to PDF, TXT to PDF, text file to PDF, offline text to PDF, free PDF tools, RDroidApps Pro, document converter, create PDF from text">

  <link rel="stylesheet" href="../../css/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Include jQuery for load function -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* Additional styles for new features */
    .progress-container {
      display: none;
      margin: 15px 0;
      padding: 10px;
      background: #ccecb9;
      border-radius: 4px;
    }

    .progress-bar {
      height: 20px;
      background: #4CAF50;
      border-radius: 3px;
      transition: width 0.3s;
    }

    .error-message {
      color: #d32f2f;
      background: #adc4d3;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      display: none;
    }

    .success-message {
      color: #388e3c;
      background: #aadbcc;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      display: none;
    }

    .preview-container {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
      max-height: 300px;
      overflow-y: auto;
      background: #a79090;
    }

    .preview-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .file-upload {
      margin: 10px 0;
    }

    .file-upload-label {
      display: inline-block;
      padding: 8px 15px;
      background: rgba(73, 4, 42, 0.720);
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #ccc;
    }

    .file-upload-label:hover {
      background: #e0e0e0;
    }

    .feature-control {
      margin-bottom: 15px;
    }

    .feature-control label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .controls-grid {
        grid-template-columns: 1fr;
      }
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, .3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <!-- HEADER (loaded from external file) -->
  <div id="header-container"></div>

  <!-- TOOLS QUICK LINKS (loaded from external file) -->
  <div id="tools-links-container"></div>

  <!-- MENU DRAWER (loaded from external file) -->
  <div id="menu-drawer-container"></div>

  <!-- Load all components -->
  <script>
    $(function () {
      $("#header-container").load("../../components/header.html");
      $("#menu-drawer-container").load("../../components/menu-drawer.html");
      $("#tools-links-container").load("../../components/pdf-tools-quick-links.html");
      $("#footer-container").load("../../components/footer.html");
    });
  </script>

  <main class="section">
    <article>
      <h1>Text → PDF</h1>
      <p class="lead">Write or paste text and convert into a formatted PDF with custom page settings.</p>

      <!-- Error and Success Messages -->
      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>

      <!-- File Upload -->
      <div class="feature-control">
        <label>Upload TXT File:</label>
        <div class="file-upload">
          <input type="file" id="fileInput" accept=".txt" style="display: none;">
          <label for="fileInput" class="file-upload-label">
            <i class="fas fa-upload"></i> Choose TXT File
          </label>
          <span id="fileName" style="margin-left: 10px;">No file chosen</span>
        </div>
      </div>

      <textarea id="txt" placeholder="Enter your text here..."></textarea>

      <!-- Real-time Preview -->
      <div class="preview-container" id="previewContainer" style="display: none;">
        <div class="preview-title">Live Preview</div>
        <div id="previewContent"></div>
      </div>

      <div class="controls-grid">
        <div class="control">
          <label>Page size</label>
          <select id="pageSize">
            <option value="A4">A4</option>
            <option value="Letter">Letter</option>
          </select>
          <label style="margin-top:10px">Orientation</label>
          <select id="orientation">
            <option value="p">Portrait</option>
            <option value="l">Landscape</option>
          </select>
        </div>

        <div class="control">
          <label>Font size</label>
          <input type="number" id="fontSize" value="12" min="8" max="72">
          <label style="margin-top:10px">Line spacing</label>
          <input type="number" id="lineGap" value="6" min="0" max="20">
          <label style="margin-top:10px">Font Family</label>
          <select id="fontFamily">
            <option value="helvetica">Helvetica (English)</option>
            <option value="notosansdevanagari">Noto Sans Devanagari (Marathi/Hindi)</option>
          </select>
        </div>

        <div class="control">
          <label>Margins (mm)</label>
          <input type="number" id="margin" value="10" min="5" max="50">
          <label style="margin-top:10px">Header text</label>
          <input type="text" id="header">
          <label style="margin-top:10px">Footer text</label>
          <input type="text" id="footer">
          <div style="margin-top:10px">
            <input type="checkbox" id="autoPageNumbers" checked>
            <label for="autoPageNumbers" style="display: inline; margin-left: 5px;">Add "Page X of Y" to footer</label>
          </div>
        </div>
      </div>

      <!-- Progress Indicator -->
      <div id="progressContainer" class="progress-container">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span id="progressText">Creating PDF...</span>
          <span id="pageCount">Page: 1</span>
        </div>
        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
      </div>

      <div style="margin-top:20px">
        <button class="btn btn-primary" id="convertBtn">
          <span id="convertText">Convert Text to PDF</span>
          <span id="convertSpinner" style="display: none;" class="loading-spinner"></span>
        </button>
        <button class="btn-secondary" id="previewBtn">Live Preview</button>
        <button class="btn-secondary" id="clearBtn">Clear All</button>
      </div>
      <pre id="log" class="log">Ready.</pre>
      <div id="download"></div>
      <!-- SEO Content -->
      <hr style="margin:32px 0">

      <section class="seo-content">
        <h2>Text to PDF Converter — RDroidApps Pro</h2>

        <p>
          The Text to PDF Converter by RDroidApps Pro lets you easily convert plain text into
          professionally formatted PDF documents directly in your browser. This tool works
          fully offline and ensures complete privacy by processing everything on your device.
        </p>

        <h2>Key Features of Text to PDF Converter</h2>

        <ul>
          <li><strong>Instant Text Conversion:</strong> Paste or type text and convert it to PDF instantly.</li>
          <li><strong>Custom Page Settings:</strong> Choose page size (A4 or Letter) and orientation.</li>
          <li><strong>Font & Line Controls:</strong> Adjust font size and line spacing for clean output.</li>
          <li><strong>Header & Footer Support:</strong> Add custom header and footer text to every page.</li>
          <li><strong>Client-Side Processing:</strong> No uploads, no tracking — everything stays on your device.</li>
          <li><strong>Free & Offline:</strong> Works without internet after page load.</li>
          <li><strong>Devanagari Support:</strong> Supports Marathi, Hindi and other Devanagari script languages.</li>
          <li><strong>File Upload:</strong> Upload .txt files directly for conversion.</li>
          <li><strong>Live Preview:</strong> See how your PDF will look before converting.</li>
        </ul>

        <h2>How to Convert Text to PDF</h2>

        <ol>
          <li><strong>Enter Text:</strong> Type or paste your content into the text area.</li>
          <li><strong>Adjust Settings:</strong> Select page size, orientation, margins, font size, and spacing.</li>
          <li><strong>Add Header/Footer:</strong> Optionally include header and footer text.</li>
          <li><strong>Convert:</strong> Click the "Convert Text to PDF" button.</li>
          <li><strong>Download:</strong> Save your generated PDF instantly.</li>
        </ol>
      </section>
    </article>
  </main>

  <!-- FOOTER (loaded from external file) -->
  <div id="footer-container"></div>

  <!-- Include Noto Sans Devanagari font -->
  <script src="noto-devanagari-base64.js"></script>

  <script>
    // Drawer toggle
    function toggleMenu() {
      document.getElementById("drawer").classList.toggle("open");
    }

    // DOM Elements
    const txt = document.getElementById("txt");
    const logEl = document.getElementById("log");
    const download = document.getElementById("download");
    const fileInput = document.getElementById("fileInput");
    const fileName = document.getElementById("fileName");
    const previewContainer = document.getElementById("previewContainer");
    const previewContent = document.getElementById("previewContent");
    const errorMessage = document.getElementById("errorMessage");
    const successMessage = document.getElementById("successMessage");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");
    const pageCount = document.getElementById("pageCount");
    const convertBtn = document.getElementById("convertBtn");
    const convertText = document.getElementById("convertText");
    const convertSpinner = document.getElementById("convertSpinner");

    // State variables
    let currentPage = 1;
    let totalPages = 1;
    let isConverting = false;

    // Function to show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      successMessage.style.display = 'none';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 5000);
    }

    // Function to show success message
    function showSuccess(message) {
      successMessage.textContent = message;
      successMessage.style.display = 'block';
      errorMessage.style.display = 'none';
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 3000);
    }

    // Function to update log
    function log(msg) {
      logEl.textContent += "\n" + msg;
      logEl.scrollTop = logEl.scrollHeight;
    }

    // Function to update progress
    function updateProgress(percent, text, currentPageNum, totalPagesNum) {
      progressBar.style.width = percent + '%';
      progressText.textContent = text;

      if (currentPageNum && totalPagesNum) {
        pageCount.textContent = `Page: ${currentPageNum} of ${totalPagesNum}`;
        currentPage = currentPageNum;
        totalPages = totalPagesNum;
      }
    }

    // Function to process tabs and multiple spaces
    function processTextWithTabs(text) {
      // Replace tabs with 4 spaces for consistent display
      return text.replace(/\t/g, '    ');
    }

    // Function to generate live preview
    function generatePreview() {
      const content = txt.value.trim();
      if (!content) {
        previewContainer.style.display = 'none';
        return;
      }

      const fs = parseFloat(document.getElementById("fontSize").value) || 12;
      const margin = parseFloat(document.getElementById("margin").value) || 10;
      const processedText = processTextWithTabs(content);

      // Create simple preview
      let previewHTML = `<div style="font-size: ${fs}px; line-height: ${fs + 6}px; padding: ${margin}px;">`;

      // Add header if exists
      const header = document.getElementById("header").value;
      if (header) {
        previewHTML += `<div style="font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">${header}</div>`;
      }

      // Add content with line breaks
      previewHTML += processedText.replace(/\n/g, '<br>');

      // Add footer if exists
      const footer = document.getElementById("footer").value;
      const autoPageNumbers = document.getElementById("autoPageNumbers").checked;
      if (footer || autoPageNumbers) {
        let footerText = footer;
        if (autoPageNumbers) {
          footerText = footerText ? `${footerText} | Page 1 of 1` : 'Page 1 of 1';
        }
        previewHTML += `<div style="margin-top: 20px; padding-top: 5px; border-top: 1px solid #ccc; font-size: ${fs - 2}px; color: #666;">${footerText}</div>`;
      }

      previewHTML += '</div>';
      previewContent.innerHTML = previewHTML;
      previewContainer.style.display = 'block';
    }

    // File upload handling
    fileInput.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.name.toLowerCase().endsWith('.txt')) {
        showError('Please select a .txt file');
        return;
      }

      fileName.textContent = file.name;

      const reader = new FileReader();
      reader.onload = function (e) {
        txt.value = e.target.result;
        generatePreview();
        showSuccess('File loaded successfully!');
      };

      reader.onerror = function () {
        showError('Error reading file');
      };

      reader.readAsText(file);
    });

    // Clear all button
    document.getElementById("clearBtn").onclick = function () {
      txt.value = '';
      fileInput.value = '';
      fileName.textContent = 'No file chosen';
      document.getElementById("header").value = '';
      document.getElementById("footer").value = '';
      previewContainer.style.display = 'none';
      download.innerHTML = '';
      log('Cleared all content.');
      showSuccess('All content cleared!');
    };

    // Live preview button
    document.getElementById("previewBtn").onclick = function () {
      generatePreview();
      if (txt.value.trim()) {
        showSuccess('Live preview updated!');
      }
    };

    // Add event listeners for real-time preview on settings change
    const previewSettings = ['pageSize', 'orientation', 'fontSize', 'lineGap', 'margin', 'header', 'footer', 'autoPageNumbers', 'fontFamily'];
    previewSettings.forEach(settingId => {
      document.getElementById(settingId).addEventListener('change', generatePreview);
    });

    // Add input event for textarea for real-time preview
    txt.addEventListener('input', generatePreview);

    // Main conversion function
    document.getElementById("convertBtn").onclick = async () => {
      if (isConverting) return;

      const content = txt.value.trim();
      if (!content) {
        showError("Please enter some text or upload a file");
        return;
      }

      // Show progress indicator
      isConverting = true;
      convertText.style.display = 'none';
      convertSpinner.style.display = 'inline-block';
      progressContainer.style.display = 'block';
      updateProgress(10, "Initializing PDF creation...", 1, 1);

      try {
        log("Creating PDF...");
        const { jsPDF } = window.jspdf;

        // Get settings
        const size = document.getElementById("pageSize").value === "A4" ? "a4" : "letter";
        const orient = document.getElementById("orientation").value === "p" ? "portrait" : "landscape";
        const margin = parseFloat(document.getElementById("margin").value) || 10;
        const fs = parseFloat(document.getElementById("fontSize").value) || 12;
        const gap = parseFloat(document.getElementById("lineGap").value) || 6;
        const fontFamily = document.getElementById("fontFamily").value;
        const header = document.getElementById("header").value;
        const footer = document.getElementById("footer").value;
        const autoPageNumbers = document.getElementById("autoPageNumbers").checked;

        updateProgress(30, "Setting up document...", 1, 1);

        // Create PDF
        const pdf = new jsPDF({ unit: "mm", format: size, orientation: orient });

        // Set font based on selection
        if (fontFamily === 'notosansdevanagari') {
          // Use Noto Sans Devanagari font
          pdf.addFileToVFS('NotoSansDevanagari-Regular.ttf', notoSansDevanagariBase64);
          pdf.addFont('NotoSansDevanagari-Regular.ttf', 'NotoSansDevanagari', 'normal');
          pdf.setFont('NotoSansDevanagari');
        } else {
          pdf.setFont('helvetica');
        }

        pdf.setFontSize(fs);

        let y = margin;
        let pageNum = 1;
        const processedContent = processTextWithTabs(content);
        const lines = processedContent.split("\n");

        updateProgress(50, "Adding content to PDF...", pageNum, 1);

        // Function to add page number to footer
        function addPageFooter(currentPageNum, totalPagesNum) {
          let footerText = footer;
          if (autoPageNumbers) {
            const pageText = `Page ${currentPageNum} of ${totalPagesNum}`;
            footerText = footerText ? `${footerText} | ${pageText}` : pageText;
          }
          if (footerText) {
            pdf.text(footerText, margin, pdf.internal.pageSize.getHeight() - 6);
          }
        }

        // First pass to count total pages
        updateProgress(60, "Calculating total pages...", pageNum, 1);
        let tempY = margin;
        let tempPageCount = 1;

        for (let i = 0; i < lines.length; i++) {
          if (tempY === margin && header) {
            tempY += fs + 3;
          }

          const wrapped = pdf.splitTextToSize(lines[i], pdf.internal.pageSize.getWidth() - margin * 2);

          for (let j = 0; j < wrapped.length; j++) {
            tempY += fs + gap;

            if (tempY > pdf.internal.pageSize.getHeight() - margin) {
              tempPageCount++;
              tempY = margin;
              if (header) {
                tempY += fs + 3;
              }
            }
          }
        }

        totalPages = tempPageCount;

        updateProgress(70, `Processing ${lines.length} lines...`, pageNum, totalPages);

        // Second pass to actually create PDF
        for (let i = 0; i < lines.length; i++) {
          // Add header on new page
          if (y === margin && header) {
            pdf.text(header, margin, y);
            y += fs + 3;
          }

          const wrapped = pdf.splitTextToSize(lines[i], pdf.internal.pageSize.getWidth() - margin * 2);

          wrapped.forEach(line => {
            // Check if we need a new page
            if (y > pdf.internal.pageSize.getHeight() - margin) {
              // Add footer to current page
              addPageFooter(pageNum, totalPages);

              // Add new page
              pdf.addPage();
              pageNum++;
              y = margin;

              // Update progress
              updateProgress(70 + (i / lines.length * 20), `Processing page ${pageNum}...`, pageNum, totalPages);

              // Add header to new page
              if (header) {
                pdf.text(header, margin, y);
                y += fs + 3;
              }
            }

            // Add text line
            pdf.text(line, margin, y);
            y += fs + gap;
          });
        }

        // Add footer to last page
        addPageFooter(pageNum, totalPages);

        updateProgress(95, "Finalizing PDF...", pageNum, totalPages);

        // Create download link
        const blob = pdf.output("blob");
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "text-converted.pdf";
        a.textContent = "Download PDF";
        a.className = "btn btn-primary";
        download.innerHTML = "";
        download.appendChild(a);

        updateProgress(100, "PDF created successfully!", pageNum, totalPages);
        log(`Done. Created PDF with ${pageNum} pages.`);
        showSuccess(`PDF created successfully with ${pageNum} pages!`);

      } catch (error) {
        console.error("PDF creation error:", error);
        showError("Error creating PDF: " + error.message);
        log("Error: " + error.message);
      } finally {
        // Hide progress indicator
        setTimeout(() => {
          progressContainer.style.display = 'none';
          convertText.style.display = 'inline';
          convertSpinner.style.display = 'none';
          isConverting = false;
          updateProgress(0, "", 1, 1);
        }, 2000);
      }
    };

    // Initial preview if there's content
    setTimeout(generatePreview, 500);
  </script>

</body>

</html>
