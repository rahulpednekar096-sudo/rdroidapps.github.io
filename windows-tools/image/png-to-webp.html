<!doctype html>
<html lang="mr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PNG → WebP — RDroid Apps</title>
  <link rel="stylesheet" href="../../css/style.css">

  <!-- Include jQuery for load function -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <!-- HEADER (loaded from external file) -->
  <div id="header-container"></div>

  <!-- TOOLS QUICK LINKS (loaded from external file) -->
  <div id="tools-links-container"></div>

  <!-- MENU DRAWER (loaded from external file) -->
  <div id="menu-drawer-container"></div>

  <!-- Load all components -->
  <script>
    $(function () {
      $("#header-container").load("../../components/header.html");
      $("#menu-drawer-container").load("../../components/menu-drawer.html");
      $("#tools-links-container").load("../../components/image-tools-quick-links.html");
      $("#footer-container").load("../../components/footer.html");
    });
  </script>

  <section class="tool-section">
    <div class="card">
      <h1>PNG → WebP</h1>
      <p class="note">Convert PNG to WebP. Transparency preserved when possible.</p>

      <label class="drop" id="dropArea">Drop PNG or <button class="btn btn-ghost" id="pickBtn">Choose
          file</button></label>
      <input type="file" id="fileInput" accept="image/png" />
      <div class="row">
        <div class="col"><label class="small">Quality</label><input type="range" id="quality" min="10" max="95"
            value="80">
          <div id="qVal">80</div>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;"><button class="btn btn-primary"
          id="startBtn">Convert</button><a id="downloadLink" class="btn" style="display:none"></a></div>
      <div id="preview" style="margin-top:12px"></div>
      <pre id="log">Ready.</pre>
    </div>
    <!-- FOOTER (loaded from external file) -->
    <div id="footer-container"></div>
  </section>

  <script>
    function toggleMenu() { document.getElementById('drawer').classList.toggle('open') }
    const pickBtn = document.getElementById('pickBtn'), fileInput = document.getElementById('fileInput'), dropArea = document.getElementById('dropArea'),
      quality = document.getElementById('quality'), qVal = document.getElementById('qVal'), startBtn = document.getElementById('startBtn'),
      downloadLink = document.getElementById('downloadLink'), preview = document.getElementById('preview'), logEl = document.getElementById('log');

    pickBtn.addEventListener('click', () => fileInput.click()); dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.style.borderColor = '#0aa37f' }); dropArea.addEventListener('drop', e => { e.preventDefault(); if (e.dataTransfer.files.length) fileInput.files = e.dataTransfer.files; });
    fileInput.addEventListener('change', () => preview.innerHTML = `<img src="${URL.createObjectURL(fileInput.files[0])}" style="max-width:420px;border-radius:8px">`);
    quality.addEventListener('input', () => qVal.textContent = quality.value);

    startBtn.addEventListener('click', () => {
      const f = fileInput.files[0]; if (!f) return alert('कृपया PNG निवडा');
      const reader = new FileReader(); reader.onload = async e => {
        const img = new Image(); img.src = e.target.result; await img.decode();
        const canvas = document.createElement('canvas'); canvas.width = img.naturalWidth; canvas.height = img.naturalHeight;
        canvas.getContext('2d').drawImage(img, 0, 0);
        canvas.toBlob(b => { const url = URL.createObjectURL(b); preview.innerHTML = `<img src="${url}" style="max-width:420px;border-radius:8px">`; downloadLink.href = url; downloadLink.download = f.name.replace(/\.png$/i, '') + '.webp'; downloadLink.textContent = 'Download'; downloadLink.style.display = 'inline-block'; }, 'image/webp', parseInt(quality.value) / 100);
      }
      reader.readAsDataURL(f);
    });
  </script>
</body>

</html>
